<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>予約確認システム</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .page-bg {
            background-image: url('images/olive.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }

        .container {
            background-color: rgba(255, 255, 255, 0.92);
        }

        .verification-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .result-display {
            margin-top: 20px;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .success {
            background-color: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #007bff;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
        }

        .btn-primary {
            background-color: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background-color: #0056b3;
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #545b62;
        }

        .reservation-info {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #2196f3;
        }

        .hidden {
            display: none;
        }
    </style>
</head>

<body class="page-bg">
    <div class="container">
        <header>
            <h1>🔍 予約確認システム</h1>
            <p>お名前と予約番号を入力して予約を確認してください</p>
        </header>

        <main>
            <section class="verification-section">
                <div class="verification-card">
                    <h2>📝 予約確認フォーム</h2>

                    <form id="verification-form">
                        <div class="form-group">
                            <label for="verification-name">お名前 *</label>
                            <input type="text" id="verification-name" required placeholder="例: 田中太郎">
                        </div>

                        <div class="form-group">
                            <label for="verification-number">予約番号 *</label>
                            <input type="number" id="verification-number" min="1" max="999" required
                                placeholder="例: 123">
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">確認する</button>
                            <button type="button" onclick="resetVerificationForm()"
                                class="btn btn-secondary">リセット</button>
                        </div>
                    </form>

                    <div id="result-display" class="result-display hidden"></div>
                    <div id="reservation-info" class="reservation-info hidden"></div>
                </div>
            </section>

            <section class="info-section">
                <div class="verification-card">
                    <h2>ℹ️ 使用方法</h2>
                    <ul>
                        <li>予約時に発行された予約番号（1-999の数字）を入力してください</li>
                        <li>お名前と予約番号が一致する場合、予約詳細が表示されます</li>
                        <li>正しい情報を入力すると成功音が鳴ります</li>
                        <li>間違った情報を入力するとエラー音が鳴ります</li>
                    </ul>
                </div>
            </section>

            <section class="info-section">
                <h2>🔗 URLリンク</h2>
                <div id="page-links" class="verification-card"></div>
            </section>
        </main>

        <footer>
            <a href="index.html" class="back-link">← メインページに戻る</a>
        </footer>
    </div>

    <script>
        // 音声ファイルのパス（実際の音声ファイルが必要）
        const SUCCESS_SOUND = 'sounds/success.mp3';
        const ERROR_SOUND = 'sounds/error.mp3';

        // 音声を再生する関数
        function playSound(soundFile) {
            try {
                const audio = new Audio(soundFile);
                audio.play().catch(e => {
                    console.log('音声の再生に失敗しました:', e);
                    // 音声ファイルがない場合はシステム音を使用
                    if (soundFile.includes('success')) {
                        // 成功音の代替（ビープ音）
                        playBeep(800, 200);
                    } else {
                        // エラー音の代替（低いビープ音）
                        playBeep(300, 500);
                    }
                });
            } catch (e) {
                console.log('音声の再生に失敗しました:', e);
            }
        }

        // ビープ音を生成する関数
        function playBeep(frequency, duration) {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                oscillator.frequency.value = frequency;
                oscillator.type = 'sine';

                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration / 1000);

                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration / 1000);
            } catch (e) {
                console.log('ビープ音の生成に失敗しました:', e);
            }
        }

        // 予約確認処理
        async function verifyReservation(name, number) {
            try {
                const response = await fetch('api/reservations.php');
                const reservations = await response.json();

                // 名前と番号が一致する予約を検索
                const matchingReservation = reservations.find(r =>
                    r.name === name && r.reservationNumber === parseInt(number)
                );

                return matchingReservation;
            } catch (error) {
                console.error('予約確認エラー:', error);
                throw new Error('予約の確認に失敗しました');
            }
        }

        // 結果を表示する関数
        function displayResult(isSuccess, reservation = null) {
            const resultDiv = document.getElementById('result-display');
            const infoDiv = document.getElementById('reservation-info');

            resultDiv.classList.remove('hidden');
            infoDiv.classList.remove('hidden');

            if (isSuccess && reservation) {
                resultDiv.className = 'result-display success';
                resultDiv.innerHTML = '✅ 予約が見つかりました！';

                infoDiv.innerHTML = `
          <h3>📋 予約詳細</h3>
          <p><strong>お名前:</strong> ${reservation.name}</p>
          <p><strong>予約番号:</strong> ${reservation.reservationNumber}</p>
          <p><strong>メニュー:</strong> ${reservation.food}</p>
          <p><strong>人数:</strong> ${reservation.people}人</p>
          <p><strong>予約日:</strong> ${reservation.date}</p>
          <p><strong>予約時間:</strong> ${reservation.time}</p>
        `;

                playSound(SUCCESS_SOUND);
            } else {
                resultDiv.className = 'result-display error';
                resultDiv.innerHTML = '❌ 予約が見つかりませんでした';

                infoDiv.innerHTML = `
          <p>お名前と予約番号を確認して、再度お試しください。</p>
          <p>予約番号は1-999の数字です。</p>
        `;

                playSound(ERROR_SOUND);
            }
        }

        // フォーム送信処理
        document.getElementById('verification-form').addEventListener('submit', async function (e) {
            e.preventDefault();

            const name = document.getElementById('verification-name').value.trim();
            const number = document.getElementById('verification-number').value;

            if (!name || !number) {
                alert('お名前と予約番号を入力してください。');
                return;
            }

            try {
                const reservation = await verifyReservation(name, number);
                displayResult(!!reservation, reservation);
            } catch (error) {
                console.error('確認エラー:', error);
                alert('予約の確認中にエラーが発生しました。しばらくしてから再度お試しください。');
            }
        });

        // フォームリセット
        function resetVerificationForm() {
            document.getElementById('verification-form').reset();
            document.getElementById('result-display').classList.add('hidden');
            document.getElementById('reservation-info').classList.add('hidden');
        }

        // ページリンクの表示
        function renderLinks() {
            const base = window.location.href.replace(/[^/]*$/, '');
            const pages = [
                { name: '生徒用サイト (index.html)', file: 'index.html' },
                { name: '予約サイト (reservation.html)', file: 'reservation.html' },
                { name: '管理者サイト (admin.html)', file: 'admin.html' },
                { name: '食堂専用AIアシスタント (ai-assistant-php.html)', file: 'ai-assistant-php.html' }
            ];
            const linksDiv = document.getElementById('page-links');
            if (!linksDiv) return;
            linksDiv.innerHTML = pages.map(p => {
                const url = base + p.file;
                return `<p><strong>${p.name}:</strong> <a href="${url}">${url}</a></p>`;
            }).join('');
        }

        // ページ読み込み時に実行
        document.addEventListener('DOMContentLoaded', function () {
            renderLinks();
        });
    </script>
</body>

</html>